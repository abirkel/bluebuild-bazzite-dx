---
# yaml-language-server: $schema=https://schema.blue-build.org/recipe-v1.json
# image will be published to ghcr.io/<user>/<name>
name: bluebuild-bazzite-dx
# description will be included in the image's metadata
description: Bazzite DX-based image with yeetmouse support

# the base image to build on top of (FROM) and the version tag to use
base-image: ghcr.io/ublue-os/bazzite-dx-nvidia
image-version: latest

# module configuration, executed in order
# you can include multiple instances of the same module
modules:
  - type: containerfile
    snippets:
      - |
        RUN curl -Lo /etc/yum.repos.d/abirkel-rpm-stable.repo \
            https://abirkel.github.io/rpm-repo/stable.repo && \
          KERNEL_VERSION=$(rpm -q kernel --queryformat "%{VERSION}-%{RELEASE}" | head -1) && \
          echo "Detected kernel version: $KERNEL_VERSION" && \
          rpm-ostree install -y \
            kmod-yeetmouse-${KERNEL_VERSION}.x86_64 \
            yeetmouse && \
          ostree container commit

  - type: signing  # Sets up policy & signing files for signed images
